<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.css">
  <!-- добавим стили mocha для отображения результатов -->
  <link rel="stylesheet" href="./css/main.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.js"></script>
  <!-- добавляем сам фреймворк mocha -->
  <script>mocha.setup('bdd');</script><!-- включаем режим тестирования в стиле BDD -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/3.5.0/chai.js"></script><!-- добавим chai -->
  <script>let assert = chai.assert;</script>
  <!-- chai предоставляет большое количество функций. Объявим assert глобально -->
  <title>JavaScript</title>
</head>

<body style="background-color: whitesmoke;">
  <!-- <h1 id="hello" class="heading" style="color: red;">Hello World!</h1> -->

  <pre id="rabbit" class="droppable" style="display: inline-block;">
  |\   /|
   \|_|/
   /. .\
  =\_Y_/=
   {>o<}
  </pre>


  <div style="display: flex; flex-direction: column; align-items: center;">
    <div id="container" style="width: 700px; height: 700px; display: flex; align-items: center; justify-content: center;">
      <img style="max-width: 100%; width: 50%;" src="https://instagram.fiev22-1.fna.fbcdn.net/v/t51.2885-15/e35/120897659_197127948463447_3750127333047493306_n.jpg?tp=1&_nc_ht=instagram.fiev22-1.fna.fbcdn.net&_nc_cat=107&_nc_ohc=0mCCWzMXrp4AX9Ew9OE&oh=9b704a9f041c03ca010d46c8a32e96bc&oe=607C7500" alt="">
   </div>
    <div id="slider">
      <div id="thumb"></div>
    </div>  
  </div>
  
  <script>

    let step = 0
    let rabbitAtTheRight = false
    let rabbitAtTheLeft = true

    let moveRight = setInterval(() => {
      if (rabbitAtTheLeft) {
        rabbit.style.marginLeft = step + 'px'
        step += 1
      }
    }, 1);

    let reverse = setInterval(() => {
      if (parseInt(rabbit.style.marginLeft, 10) + rabbit.offsetWidth >= document.documentElement.offsetWidth) {
        rabbitAtTheLeft = false
        rabbitAtTheRight = true
      }
    }, 1);

    let moveLeft= setInterval(() => {
      if (rabbitAtTheRight) {
        rabbit.style.marginLeft = step + 'px'
        step -= 1
        if (step <= 0) {
          rabbitAtTheRight = false
          rabbitAtTheLeft = true
        }
      }
    }, 1);











    let ow = container.querySelector('img').offsetWidth
    thumb.addEventListener('mousedown', function (event) {
      thumb.ondragstart = function () {
        return false
      }
      event.preventDefault()
      
      let shiftX = event.clientX - thumb.getBoundingClientRect().left

      function moveAt (clientX) {
        let newX = clientX - slider.getBoundingClientRect().left - shiftX
        if (newX < 0) {
          newX = 0
        } else if (newX > slider.offsetWidth - thumb.offsetWidth) {
          newX = slider.offsetWidth - thumb.offsetWidth
        }
        thumb.style.left = newX + 'px'
        zoom(newX)
      }

      function zoom (newX) {
        let img = container.querySelector('img')
        // let percent = newX/(slider.offsetWidth - thumb.offsetWidth) * 100
        // img.style.maxWidth = percent + '%'
        let newWidth = newX
        
        if (newX < (slider.offsetWidth - thumb.offsetWidth)/2) {
          img.style.width = ow - ((slider.offsetWidth - thumb.offsetWidth)/2 - newX)*2 + 'px'
        } else if (newX > (slider.offsetWidth - thumb.offsetWidth)/2) {
          img.style.width = ow + (newX - (slider.offsetWidth - thumb.offsetWidth)/2)*2 + 'px'
        } else if (newX = (slider.offsetWidth - thumb.offsetWidth)/2) {
          img.style.width = ow + 'px'
        }
      }



      moveAt(event.clientX)

      function onMouseMove (event) {
        moveAt(event.clientX)
      }

      document.addEventListener('mousemove', onMouseMove)
      document.addEventListener('mouseup', onMouseUp)

      

      function onMouseUp () {
        document.removeEventListener('mousemove', onMouseMove)
        document.removeEventListener('mouseup', onMouseUp)
      }



    })


    thumb.addEventListener('touchstart', function (event) {
      thumb.ondragstart = function () {
        return false
      }
      event.preventDefault()

      
      
      let shiftX = event.touches[0].clientX - thumb.getBoundingClientRect().left

      function moveAt (clientX) {
        let newX = clientX - slider.getBoundingClientRect().left - shiftX
        if (newX < 0) {
          newX = 0
        } else if (newX > slider.offsetWidth - thumb.offsetWidth) {
          newX = slider.offsetWidth - thumb.offsetWidth
        }
        thumb.style.left = newX + 'px'
        zoom(newX)
      }

      function zoom (newX) {
        let img = container.querySelector('img')
        // let percent = newX/(slider.offsetWidth - thumb.offsetWidth) * 100
        // img.style.maxWidth = percent + '%'
        let newWidth = newX
        
        if (newX < (slider.offsetWidth - thumb.offsetWidth)/2) {
          img.style.width = ow - ((slider.offsetWidth - thumb.offsetWidth)/2 - newX)*2 + 'px'
        } else if (newX > (slider.offsetWidth - thumb.offsetWidth)/2) {
          img.style.width = ow + (newX - (slider.offsetWidth - thumb.offsetWidth)/2)*2 + 'px'
        } else if (newX = (slider.offsetWidth - thumb.offsetWidth)/2) {
          img.style.width = ow + 'px'
        }
      }



      moveAt(event.touches[0].clientX)

      function onMouseMove (event) {
        moveAt(event.touches[0].clientX)
      }

      document.addEventListener('touchmove', onMouseMove)
      document.addEventListener('touchend', onMouseUp)

      

      function onMouseUp () {
        document.removeEventListener('touchmove', onMouseMove)
        document.removeEventListener('touchend', onMouseUp)
      }



    })


  </script>

  <script src="/JS/app.js"></script>

</body>

</html>